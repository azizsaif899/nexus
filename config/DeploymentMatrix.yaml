# Ù…ØµÙÙˆÙØ© Ø§Ù„Ù†Ø´Ø± - Deployment Matrix
# ØªØ­Ø¯Ø¯ Ù…ØªÙ‰ ÙŠÙØ³Ù…Ø­ Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø§Ù„Ø±ÙØ¹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±

version: "1.0"
last_updated: "2024-01-15"

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¹Ø§Ù…Ø©
global_rules:
  require_human_review: true
  max_concurrent_deployments: 2
  deployment_window: "09:00-17:00"
  emergency_override: true

# Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª
deployment_matrix:
  
  # Ù…Ø³Ø§Ø¹Ø¯ Copilot
  copilot:
    allowed_changes:
      - ui
      - frontend
      - test
      - docs
    
    restrictions:
      ui:
        conditions:
          - backend_stable: true
          - no_breaking_changes: true
        dependencies:
          - check: "ai_models_compatible"
            action: "block_if_false"
      
      frontend:
        conditions:
          - api_version_match: true
          - css_conflicts_resolved: true
        dependencies:
          - check: "backend_endpoints_available"
            action: "warn_if_false"
      
      test:
        conditions:
          - existing_tests_pass: true
        dependencies: []
      
      docs:
        conditions: []
        dependencies: []
    
    blocked_changes:
      - ai
      - config
      - critical
    
    auto_deploy: false
    require_approval: true

  # Ù…Ø³Ø§Ø¹Ø¯ Gemini  
  gemini:
    allowed_changes:
      - ai
      - agents
      - analysis
      - docs
    
    restrictions:
      ai:
        conditions:
          - ui_compatible: true
          - memory_usage_acceptable: true
          - api_rate_limits_ok: true
        dependencies:
          - check: "ui_components_stable"
            action: "block_if_false"
          - check: "database_schema_compatible"
            action: "warn_if_false"
      
      agents:
        conditions:
          - agent_conflicts_resolved: true
          - resource_limits_ok: true
        dependencies:
          - check: "other_agents_stable"
            action: "block_if_false"
      
      analysis:
        conditions:
          - data_sources_available: true
        dependencies:
          - check: "sheets_api_accessible"
            action: "block_if_false"
    
    blocked_changes:
      - ui
      - critical
      - config
    
    auto_deploy: true
    require_approval: false

  # Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø¨Ø´Ø±ÙŠ
  human:
    allowed_changes:
      - critical
      - config
      - architecture
      - security
      - ui
      - ai
      - docs
    
    restrictions:
      critical:
        conditions:
          - backup_created: true
          - rollback_plan_ready: true
        dependencies:
          - check: "all_systems_healthy"
            action: "block_if_false"
      
      config:
        conditions:
          - config_validated: true
          - dependent_services_notified: true
        dependencies:
          - check: "no_active_deployments"
            action: "block_if_false"
      
      architecture:
        conditions:
          - impact_analysis_complete: true
          - migration_plan_ready: true
        dependencies:
          - check: "all_assistants_idle"
            action: "warn_if_false"
    
    blocked_changes: []
    auto_deploy: false
    require_approval: false

# Ø´Ø±ÙˆØ· Ø§Ù„ØªÙˆØ§ÙÙ‚
compatibility_checks:
  
  ui_components_stable:
    description: "ÙØ­Øµ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©"
    command: "npm run test:ui"
    timeout: 60
    retry_count: 2
  
  ai_models_compatible:
    description: "ÙØ­Øµ ØªÙˆØ§ÙÙ‚ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"
    command: "node scripts/check_ai_compatibility.js"
    timeout: 120
    retry_count: 1
  
  backend_endpoints_available:
    description: "ÙØ­Øµ ØªÙˆÙØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"
    command: "curl -f http://localhost:8080/health"
    timeout: 30
    retry_count: 3
  
  database_schema_compatible:
    description: "ÙØ­Øµ ØªÙˆØ§ÙÙ‚ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
    command: "node scripts/check_db_schema.js"
    timeout: 45
    retry_count: 1
  
  sheets_api_accessible:
    description: "ÙØ­Øµ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ Google Sheets"
    command: "node scripts/test_sheets_connection.js"
    timeout: 30
    retry_count: 2
  
  all_systems_healthy:
    description: "ÙØ­Øµ ØµØ­Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©"
    command: "npm run health:full"
    timeout: 180
    retry_count: 1

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ¶Ø§Ø±Ø¨
conflict_resolution:
  
  # ØªØ¶Ø§Ø±Ø¨ Ø¨ÙŠÙ† UI Ùˆ AI
  ui_ai_conflict:
    priority: "human"
    action: "block_lower_priority"
    notification: "slack"
    message: "ØªØ¶Ø§Ø±Ø¨ Ø¨ÙŠÙ† ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"
  
  # ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©
  critical_files_conflict:
    priority: "human"
    action: "block_all"
    notification: "emergency"
    message: "ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© - Ù…Ø±Ø§Ø¬Ø¹Ø© ÙÙˆØ±ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©"
  
  # ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  config_conflict:
    priority: "human"
    action: "queue_changes"
    notification: "slack"
    message: "ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„"

# Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©
deployment_windows:
  
  normal:
    days: ["monday", "tuesday", "wednesday", "thursday", "friday"]
    hours: "09:00-17:00"
    timezone: "Asia/Riyadh"
  
  maintenance:
    days: ["saturday"]
    hours: "02:00-06:00"
    timezone: "Asia/Riyadh"
    allowed_changes: ["critical", "config", "security"]
  
  emergency:
    days: ["all"]
    hours: "all"
    conditions:
      - severity: "critical"
      - human_approval: true

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
notifications:
  
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channels:
      deployment: "#deployments"
      alerts: "#alerts"
      general: "#general"
  
  discord:
    webhook_url: "${DISCORD_WEBHOOK_URL}"
    channels:
      deployment: "deployments"
      alerts: "alerts"
  
  email:
    smtp_server: "${SMTP_SERVER}"
    recipients:
      critical: ["admin@example.com"]
      deployment: ["team@example.com"]

# Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
message_templates:
  
  deployment_blocked:
    title: "ğŸš« Ù†Ø´Ø± Ù…Ø­Ø¸ÙˆØ±"
    body: |
      Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: {assistant}
      Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: {change_type}
      Ø§Ù„Ø³Ø¨Ø¨: {reason}
      Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: {required_action}
  
  deployment_approved:
    title: "âœ… Ù†Ø´Ø± Ù…Ø¹ØªÙ…Ø¯"
    body: |
      Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: {assistant}
      Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: {change_type}
      Ø§Ù„Ù…Ù„ÙØ§Øª: {files_count}
      Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: {estimated_time}
  
  conflict_detected:
    title: "âš ï¸ ØªØ¶Ø§Ø±Ø¨ Ù…ÙƒØªØ´Ù"
    body: |
      Ù†ÙˆØ¹ Ø§Ù„ØªØ¶Ø§Ø±Ø¨: {conflict_type}
      Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†: {affected_assistants}
      Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ¶Ø§Ø±Ø¨Ø©: {conflicting_files}
      Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: {resolution_action}

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
monitoring:
  
  health_checks:
    interval: 30 # Ø«Ø§Ù†ÙŠØ©
    timeout: 10 # Ø«Ø§Ù†ÙŠØ©
    endpoints:
      - "/health"
      - "/api/status"
      - "/metrics"
  
  performance_thresholds:
    response_time: 500 # ms
    memory_usage: 80 # %
    cpu_usage: 70 # %
    error_rate: 1 # %
  
  alerts:
    escalation_time: 300 # Ø«Ø§Ù†ÙŠØ©
    max_retries: 3
    cooldown_period: 600 # Ø«Ø§Ù†ÙŠØ©