name: ğŸ‘®â€â™‚ï¸ Quality Guardian (Ø§Ù„Ø±Ù‚ÙŠØ¨)

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  quality-gate:
    name: Quality Gate Check
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: ğŸ” Code Quality Analysis
      run: |
        echo "ğŸ” Ø¨Ø¯Ø¡ ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯..."
        
        # ÙØ­Øµ ESLint
        echo "ğŸ“ ÙØ­Øµ ESLint..."
        npm run lint || LINT_FAILED=true
        
        # ÙØ­Øµ TypeScript
        echo "ğŸ”§ ÙØ­Øµ TypeScript..."
        npm run type-check || TS_FAILED=true
        
        # ÙØ­Øµ Prettier
        echo "âœ¨ ÙØ­Øµ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚..."
        npx prettier --check . || FORMAT_FAILED=true
        
        # ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        if [ "$LINT_FAILED" = true ] || [ "$TS_FAILED" = true ] || [ "$FORMAT_FAILED" = true ]; then
          echo "âš ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯"
          exit 1
        else
          echo "âœ… Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯ Ù…Ù…ØªØ§Ø²Ø©!"
        fi
    
    - name: ğŸ“Š Test Coverage Check
      run: |
        echo "ğŸ“Š ÙØ­Øµ ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª..."
        npm run test:coverage || echo "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ÙØ­Øµ Ø§Ù„ØªØºØ·ÙŠØ©"
    
    - name: ğŸ“¦ Bundle Size Analysis
      run: |
        echo "ğŸ“¦ ØªØ­Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø­Ø²Ù…Ø©..."
        npm run build
        if [ -d "dist" ]; then
          BUNDLE_SIZE=$(du -sb dist/ | cut -f1)
          echo "Ø­Ø¬Ù… Ø§Ù„Ø­Ø²Ù…Ø©: $BUNDLE_SIZE bytes"
          
          # ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± (Ø£ÙƒØ«Ø± Ù…Ù† 5MB)
          if [ $BUNDLE_SIZE -gt 5242880 ]; then
            echo "âš ï¸ ØªØ­Ø°ÙŠØ±: Ø­Ø¬Ù… Ø§Ù„Ø­Ø²Ù…Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹!"
          else
            echo "âœ… Ø­Ø¬Ù… Ø§Ù„Ø­Ø²Ù…Ø© Ù…Ù‚Ø¨ÙˆÙ„"
          fi
        fi
    
    - name: ğŸ›¡ï¸ Security Check
      run: |
        echo "ğŸ›¡ï¸ ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†..."
        npm audit --audit-level=high || echo "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†"
    
    - name: ğŸ“‹ Quality Report
      if: always()
      run: |
        echo "ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:"
        echo "================================"
        echo "âœ… ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯: Ù…ÙƒØªÙ…Ù„"
        echo "âœ… ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†: Ù…ÙƒØªÙ…Ù„" 
        echo "âœ… ÙØ­Øµ Ø§Ù„Ø­Ø²Ù…Ø©: Ù…ÙƒØªÙ…Ù„"
        echo "ğŸ¯ Ø§Ù„Ø±Ù‚ÙŠØ¨: Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±!"