// *************************************************************************************************
// --- START OF FILE: ui/DeveloperSidebar.html ---
// *************************************************************************************************
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Tools</title>
    <style>
        :root {
            --bg-primary: #111827; --bg-secondary: #1f2937; --bg-tertiary: #374151;
            --text-primary: #f9fafb; --text-secondary: #d1d5db; --text-accent: #93c5fd;
            --border-color: #4b5563; --accent-color: #3b82f6; --accent-hover: #2563eb;
            --error-color: #f87171; --success-color: #4ade80;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-primary); color: var(--text-primary);
            margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column;
        }
        .tabs { display: flex; background-color: var(--bg-secondary); border-bottom: 1px solid var(--border-color); overflow-x: auto; flex-shrink: 0; }
        .tab-button {
            flex-shrink: 0; padding: 0.75rem 1rem; border: none; background: none; color: var(--text-secondary);
            font-size: 0.85rem; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent;
            transition: color 0.2s, border-color 0.2s; white-space: nowrap;
        }
        .tab-button.active { color: var(--text-accent); border-bottom-color: var(--accent-color); }
        .tab-content { display: none; padding: 1rem; flex-grow: 1; overflow-y: auto; }
        .tab-content.active { display: flex; flex-direction: column; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9em;}
        input, textarea, select {
            width: 100%; padding: 0.5rem; background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color); color: var(--text-primary);
            border-radius: 6px; box-sizing: border-box; font-size: 14px;
        }
        textarea { min-height: 120px; font-family: 'SF Mono', 'Fira Code', 'Fira Mono', 'Roboto Mono', monospace; line-height: 1.4; }
        button {
            width: 100%; padding: 0.75rem; background-color: var(--accent-color); color: var(--text-primary);
            border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: background-color 0.2s;
            margin-top: 0.5rem;
        }
        button:hover:not(:disabled) { background-color: var(--accent-hover); }
        button:disabled { background-color: var(--bg-tertiary); cursor: not-allowed; opacity: 0.6; }
        .result-area {
            margin-top: 1rem; padding: 1rem; background-color: var(--bg-secondary);
            border-radius: 6px; flex-grow: 1; overflow-y: auto; white-space: pre-wrap; font-size: 0.9em;
        }
        .feedback-item {
            border-left: 3px solid var(--accent-color); padding: 0.75rem 1rem;
            margin-bottom: 1rem; background-color: var(--bg-tertiary); border-radius: 4px;
        }
        .feedback-item h5 { margin: 0 0 0.5rem 0; color: var(--text-accent); }
        pre, code { background-color: var(--bg-primary) !important; padding: 0.75rem; border-radius: 4px; overflow-x: auto;}
        .message { font-style: italic; color: var(--text-secondary); text-align: center; padding: 1rem; }
    </style>
</head>
<body>

    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'codeReview')">ğŸ‘¨â€ğŸ’» Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯</button>
        <button class="tab-button" onclick="openTab(event, 'projectInsights')">ğŸ“Š Ø±Ø¤Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
        <button class="tab-button" onclick="openTab(event, 'api')">ğŸ“¡ ÙˆØ§Ø¬Ù‡Ø© API</button>
        <button class="tab-button" onclick="openTab(event, 'workshop')">ğŸ§ª ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„</button>
    </div>

    <!-- Tab: Code Review -->
    <div id="codeReview" class="tab-content active">
        <div class="form-group">
            <textarea id="codeText" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¬Ù„Ø¨..."></textarea>
            <button onclick="getCodeFromCell()">ğŸ“¥ Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø®Ù„ÙŠØ©</button>
        </div>
        <div class="form-group">
            <label for="reviewType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</label>
            <select id="reviewType">
                <option value="general">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ø§Ù…Ø©</option>
                <option value="performance">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡</option>
                <option value="security">ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†</option>
            </select>
        </div>
        <button id="reviewBtn" onclick="runCodeReview()">âœ¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯</button>
        <div id="reviewResult" class="result-area" style="display:none;"></div>
    </div>

    <!-- Tab: Project Insights -->
    <div id="projectInsights" class="tab-content">
        <h3>ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
        <div class="form-group">
            <label for="projectQuery">Ø§ÙƒØªØ¨ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ</label>
            <input type="text" id="projectQuery" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ JSDoc">
        </div>
        <button id="insightsBtn" onclick="runProjectAnalysis()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¢Ù†</button>
        <div id="insightsResult" class="result-area" style="display:none;"></div>
    </div>
    
    <!-- Tab: API -->
    <div id="api" class="tab-content">
        <h3>ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ø¬Ù‡Ø© API</h3>
        <p class="text-xs text-gray-400">Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø®Ø¯Ù…Ø§Øª G-Assistant Ù…Ù† ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©.</p>
        <button id="apiSchemaBtn" onclick="getApiSchema()">ğŸ“‹ Ø¹Ø±Ø¶ ØªÙˆØ«ÙŠÙ‚ API</button>
        <div id="apiSchemaResult" class="result-area" style="display:none;"></div>
    </div>

    <!-- Tab: Developer Workshop -->
    <div id="workshop" class="tab-content">
        <h3>ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</h3>
        <p class="text-xs text-gray-400">Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ†ØªØ¸Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</p>
        <button id="workshopBtn" onclick="viewWorkshop()">ğŸ”„ Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ±Ø´Ø©</button>
        <div id="workshopResult" class="result-area" style="display:none;"></div>
    </div>

    <script>
        // --- Core UI Functions ---
        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = "none");
            document.querySelectorAll('.tab-button').forEach(tb => tb.classList.remove('active'));
            document.getElementById(tabName).style.display = "flex";
            evt.currentTarget.classList.add('active');
        }

        function setLoading(btn, resultArea, isLoading, originalText, loadingText) {
            btn.disabled = isLoading;
            btn.textContent = isLoading ? '...' : originalText;
            resultArea.style.display = 'block';
            if (isLoading) resultArea.innerHTML = `<p class="message">${loadingText}</p>`;
        }

        function handleFailure(btn, resultArea, originalText, error) {
            setLoading(btn, resultArea, false, originalText, '');
            resultArea.innerHTML = `<p style="color:var(--error-color);"><b>Ø®Ø·Ø£:</b><br>${error.message}</p>`;
        }
        
        function escapeHtml(unsafe) { return unsafe.replace(/&/g, "&").replace(/</g, "<").replace(/>/g, ">").replace(/"/g, """).replace(/'/g, "'"); }

        // --- Tab-Specific Logic ---
        function getCodeFromCell() { google.script.run.withSuccessHandler(code => { if(code) document.getElementById('codeText').value = code; }).getCodeFromActiveCell(); }
        
        function runCodeReview() {
            const code = document.getElementById('codeText').value, type = document.getElementById('reviewType').value;
            const btn = document.getElementById('reviewBtn'), resultArea = document.getElementById('reviewResult');
            if (!code) return; setLoading(btn, resultArea, true, 'âœ¨ Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©...');
            google.script.run
                .withSuccessHandler(res => { setLoading(btn, resultArea, false, 'âœ¨ Ù…Ø±Ø§Ø¬Ø¹Ø©', ''); displayReviewResults(resultArea, res); })
                .withFailureHandler(err => handleFailure(btn, resultArea, 'âœ¨ Ù…Ø±Ø§Ø¬Ø¹Ø©', err)).reviewCode(code, type);
        }

        function runProjectAnalysis() {
            const query = document.getElementById('projectQuery').value;
            const btn = document.getElementById('insightsBtn'), resultArea = document.getElementById('insightsResult');
            if (!query) return; setLoading(btn, resultArea, true, 'ğŸ” ØªØ­Ù„ÙŠÙ„', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...');
            google.script.run
                .withSuccessHandler(res => { setLoading(btn, resultArea, false, 'ğŸ” ØªØ­Ù„ÙŠÙ„', ''); displayInsightsResults(resultArea, res); })
                .withFailureHandler(err => handleFailure(btn, resultArea, 'ğŸ” ØªØ­Ù„ÙŠÙ„', err)).analyzeProject({userQuery: query});
        }
        
        function getApiSchema() {
            const btn = document.getElementById('apiSchemaBtn'), resultArea = document.getElementById('apiSchemaResult');
            setLoading(btn, resultArea, true, 'ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚...');
            google.script.run
                .withSuccessHandler(res => { setLoading(btn, resultArea, false, 'ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', ''); displayApiSchema(resultArea, res); })
                .withFailureHandler(err => handleFailure(btn, resultArea, 'ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', err)).getApiSchema();
        }

        function viewWorkshop() { alert('Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„.'); }

        // --- Result Display Functions ---
        function displayReviewResults(resultArea, response) {
            if (response.type === 'error') { resultArea.innerHTML = `<p style="color:var(--error-color);">${response.text}</p>`; return; }
            if (response.type === 'success' && response.data) {
                const data = response.data;
                let html = `<h4>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${data.overallScore || 'N/A'}/100</h4><p>${data.summary || ''}</p>`;
                (data.feedbackItems || []).forEach(item => { html += `<div class="feedback-item"><h5>${item.title || ''} (${item.category || ''})</h5><p>${item.description || ''}</p>${item.codeSnippet ? `<pre><code>${escapeHtml(item.codeSnippet)}</code></pre>` : ''}</div>`; });
                if(data.patch) { html += `<div class="feedback-item"><h5>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‚ØªØ±Ø­ (Patch)</h5><pre><code>${escapeHtml(data.patch)}</code></pre></div>`; }
                resultArea.innerHTML = html;
            } else { resultArea.textContent = response.text; }
        }
        
        function displayInsightsResults(resultArea, response) {
            if (response.type === 'error') { resultArea.innerHTML = `<p style="color:var(--error-color);">${response.text}</p>`; return; }
            if (response.type === 'success' && response.data) {
                const data = response.data;
                let html = `<p>${data.summary}</p>`;
                (data.suggestions || []).forEach(item => { html += `<div class="feedback-item"><h5>${item.file}</h5><p>${item.description}</p>${item.codeSnippet ? `<pre><code>${escapeHtml(item.codeSnippet)}</code></pre>` : ''}</div>`; });
                resultArea.innerHTML = html;
            } else { resultArea.textContent = response.text; }
        }

        function displayApiSchema(resultArea, response) {
            if (response.type === 'error') { resultArea.innerHTML = `<p style="color:var(--error-color);">${response.text}</p>`; return; }
            if (response.type === 'success' && response.data) {
                let html = `<h4>${response.data.description}</h4>`;
                for (const endpoint in response.data.endpoints) {
                    const details = response.data.endpoints[endpoint];
                    html += `<div class="feedback-item"><h5>${endpoint} <span style="font-weight:normal;color:var(--text-secondary)">(${details.method})</span></h5><p>${details.description}</p><pre><code>${JSON.stringify(details.params, null, 2)}</code></pre></div>`;
                }
                resultArea.innerHTML = html;
            }
        }

        document.addEventListener("DOMContentLoaded", () => { document.querySelector('.tab-button').click(); });
    </script>
</body>
</html>
// *************************************************************************************************
// --- END OF FILE: ui/DeveloperSidebar.html ---
// *************************************************************************************************