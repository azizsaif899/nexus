# 🎯 معايير كتابة الكود - G-Assistant NX

### الإصدار: 4.0 | الحالة: إلزامي وغير قابل للتفاوض
> _"الكود النظيف ليس مجرد أسلوب، بل ثقافة تُبنى عليها الأنظمة الذكية."_

---

## 🧠 فلسفة المشروع

- **الوضوح أولًا:** الكود يجب أن يُفهم دون شرح.
- **الاستدامة:** كل سطر يُكتب يجب أن يخدم النظام على المدى الطويل.
- **الذكاء التفاعلي:** الوكلاء البرمجيون يجب أن يتعاونوا بسلاسة.
- **المرونة:** النظام قابل للتوسع والتعديل دون كسر أي وحدة.

---

## 🛠️ أدوات الفحص والتنسيق

| الأداة | الوظيفة | الحالة |
|--------|---------|--------|
| `Prettier` | تنسيق الكود تلقائيًا | إلزامي |
| `ESLint` | كشف الأخطاء الأسلوبية | إلزامي |
| `Git Hooks` | منع الدمج قبل الفحص | إلزامي |
| `CI/CD` | فحص تلقائي عبر GitHub Actions | إلزامي |

---

## 🧩 أنماط كتابة الكود

### 📦 المتغيرات والدوال
- `camelCase` للمتغيرات والدوال
- `UPPER_SNAKE_CASE` للثوابت
- `PascalCase` للكلاسات والأنواع
- `_camelCase` للمتغيرات الخاصة

### 🔐 التصريح عن المتغيرات
```typescript
const MAX_RETRIES = 3; // ثابت
let userScore = 0;     // متغير قابل للتغيير
```

### 🧠 معالجة الأخطاء
```typescript
try {
  const result = await fetchData();
} catch (error) {
  Logger.error('فشل في جلب البيانات:', error);
  throw new Error('خطأ في الاتصال');
} finally {
  cleanup();
}
```

---

## 🧪 معايير الاختبار (Testing Standards)

> "الكود الذي لا يمكن اختباره هو كود سيء، بغض النظر عن مدى ذكائه."

- **إلزامية الاختبارات:** لا يتم قبول أي ميزة جديدة أو إصلاح خطأ بدون اختبارات وحدة (Unit Tests) وتكامل (Integration Tests) كافية.
- **التطوير الموجه بالاختبار (TDD):** يُشجع بشدة على اتباع نهج TDD، خاصة للميزات الجديدة. اكتب اختبارًا فاشلاً أولاً، ثم اكتب الكود الذي يجعله ينجح.
- **تغطية الكود (Code Coverage):** يجب ألا تقل تغطية الكود عن 85% للوحدات الجديدة. استخدم `pnpm test:coverage` للتحقق.
- **الاختبارات الشاملة (E2E):** يجب إضافة اختبارات E2E لتدفقات المستخدم الحرجة.
- **المحاكاة (Mocking):** يجب محاكاة جميع الاعتماديات الخارجية (APIs, Databases) في اختبارات الوحدة لضمان عزلها وسرعتها.
- **المرجع:** `docs/testing/comprehensive-testing-guide.md`

---

## 📝 التوثيق والتعليقات

### 💬 فلسفة التعليق
> اشرح "لماذا" وليس "ماذا"

### 📚 JSDoc إلزامي
```typescript
/**
 * يحلل أمر المستخدم ويوجهه للوكيل المناسب
 * @param {string} command - الأمر النصي
 * @param {object} context - سياق المحادثة
 * @returns {Promise<string>} - رد الوكيل
 * @throws {Error} - إذا لم يُعثر على وكيل مناسب
 */
async function processCommand(command: string, context: object): Promise<string> {
  // ...
}
```

---

## 🏛️ معايير العمل في Monorepo (Nx)

> "التنظيم ليس قيدًا، بل هو أداة للسرعة."

- **استخدام أوامر Nx:** استخدم دائمًا أوامر `nx` لتشغيل المهام (`serve`, `build`, `test`, `lint`). هذا يضمن استخدام التخزين المؤقت (caching) ويزيد من سرعة التطوير.
  ```bash
  # خاطئ
  npm run test -- --project=api
  # صحيح
  pnpm nx test api
  ```
- **الاعتماديات بين الحزم:** يجب أن تكون جميع الاعتماديات بين الحزم (`packages`) والتطبيقات (`apps`) محددة بوضوح في ملفات `package.json` الخاصة بها.
- **فصل الاهتمامات:**
  - `apps/`: تحتوي فقط على الكود الخاص بالتطبيق (مثل controllers في NestJS أو components في React).
  - `packages/`: تحتوي على المنطق القابل لإعادة الاستخدام (مثل خدمات، أدوات، تعريفات أنواع).

---

## 🔌 تصميم واجهات برمجة التطبيقات (API Design)

- **اتباع RESTful:** استخدم أفعال HTTP بشكل صحيح (`GET`, `POST`, `PUT`, `DELETE`).
- **هيكل الـ URL:** يجب أن تكون الموارد بصيغة الجمع (`/users`, `/projects`).
- **هيكل الاستجابة الموحد:** يجب أن تتبع جميع استجابات الـ API هيكلًا موحدًا.
  ```typescript
  // استجابة ناجحة
  {
    "success": true,
    "data": { ... }
  }

  // استجابة خاطئة
  {
    "success": false,
    "error": {
      "code": "ERROR_CODE",
      "message": "وصف للخطأ"
    }
  }
  ```

---

## 🛡️ أفضل الممارسات الأمنية (Security Best Practices)

- **لا ترفع الأسرار:** يُمنع منعًا باتًا رفع أي مفاتيح API أو كلمات مرور أو أي معلومات حساسة أخرى إلى المستودع. استخدم دائمًا ملفات `.env` التي يتم تجاهلها بواسطة `.gitignore`.
- **صحة المدخلات (Input Validation):** تحقق دائمًا من صحة جميع المدخلات القادمة من المستخدم أو من واجهات API أخرى باستخدام مكتبات مثل `zod` أو `class-validator`.
- **التحقق من الصلاحيات:** يجب حماية جميع نقاط النهاية (Endpoints) التي تتطلب صلاحيات باستخدام حراس المصادقة والتخويل (Authentication/Authorization Guards).

---

## 🌿 سير عمل Git (Git Workflow)

- **استراتيجية الفروع:** يجب أن تتبع أسماء الفروع النمط التالي:
  - `feature/<issue-id>-description` (e.g., `feature/PROJ-123-add-login-page`)
  - `fix/<issue-id>-description` (e.g., `fix/PROJ-124-fix-auth-bug`)
  - `chore/update-dependencies`
- **طلبات السحب (Pull Requests):** يجب أن يكون لكل طلب سحب وصف واضح يوضح "ماذا" تم تغييره و "لماذا". يجب ربطه بالـ Issue ذي الصلة.
```