# دليل استكشاف الأخطاء وإصلاحها (Troubleshooting)

**الإصدار:** 1.0
**الحالة:** وثيقة حية (يتم تحديثها باستمرار)

---

## 1.0 مقدمة

هذا الدليل هو المرجع الأول لتشخيص وحل المشاكل والأخطاء الشائعة التي قد تواجهك أثناء تطوير أو استخدام `g-assistant`. قبل الإبلاغ عن مشكلة جديدة، يرجى مراجعة هذا الدليل والبحث عن حل.

---

## 2.0 أخطاء المصادقة والوصول (Authentication & Access Errors)

### 2.1 خطأ: `Error 403: access_denied`

- **الأعراض:** يظهر هذا الخطأ عند محاولة تشغيل المصادقة لأول مرة من داخل Google Apps Script.
- **السبب:** لم يتم إضافة حساب Google الخاص بك إلى قائمة "Test Users" في شاشة موافقة OAuth (OAuth Consent Screen) في مشروع Google Cloud المرتبط.
- **الحل:**
  1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com/).
  2. انتقل إلى "APIs & Services" -> "OAuth consent screen".
  3. تحت قسم "Test users"، انقر على "Add users".
  4. أضف عنوان البريد الإلكتروني الذي تستخدمه للمصادقة.
  5. احفظ التغييرات وحاول المصادقة مرة أخرى.

### 2.2 خطأ: `Error: invalid_grant`

- **الأعراض:** يظهر هذا الخطأ بعد فترة من الاستخدام الناجح، ويتسبب في توقف التطبيق عن العمل عند محاولة استخدام واجهات Google API.
- **السبب:** انتهت صلاحية أو تم إبطال توكن المصادقة (Refresh Token) الذي تم تخزينه بواسطة `PropertiesService`.
- **الحل:**
  1. اذهب إلى محرر Google Apps Script.
  2. اذهب إلى "Project Settings" -> "Script properties".
  3. ابحث عن الخاصية التي تخزن التوكن (عادة ما يكون اسمها `google.token` أو مشابه).
  4. **احذف** هذه الخاصية.
  5. قم بتشغيل التطبيق مرة أخرى. سيطلب منك إعادة المصادقة من جديد، مما سيؤدي إلى إنشاء توكن جديد وصالح.

---

## 3.0 مشاكل متعلقة بـ `clasp` (CLI Tool)

### 3.1 خطأ: `clasp: command not found`

- **الأعراض:** لا يتعرف النظام على الأمر `clasp` في الطرفية.
- **السبب:** لم يتم تثبيت `clasp` بشكل عام (globally) باستخدام `npm`.
- **الحل:**
  ```bash
  npm install -g @google/clasp
  ```

### 3.2 خطأ: `Manifest file has been updated. Please pull.`

- **الأعراض:** يظهر هذا الخطأ عند محاولة `clasp push`.
- **السبب:** تم إجراء تغييرات على ملف `appsscript.json` في محرر Apps Script مباشرة، وهو الآن غير متزامن مع نسختك المحلية.
- **الحل:**
  1. قم بسحب التغييرات من الخادم لمزامنة ملف المانيفست المحلي:
     ```bash
     clasp pull
     ```
  2. بعد ذلك، يمكنك محاولة الدفع مرة أخرى.

---

## 4.0 كيفية الإبلاغ عن مشكلة جديدة

إذا لم تجد حلاً لمشكلتك في هذا الدليل، يرجى اتباع الخطوات التالية:

1.  **اجمع المعلومات:** قم بتجميع أكبر قدر ممكن من المعلومات حول المشكلة:
    - رسالة الخطأ الكاملة من `Logger.log` أو الطرفية.
    - الخطوات الدقيقة التي تؤدي إلى حدوث المشكلة.
    - لقطة شاشة (Screenshot) إن أمكن.
2.  **افتح Issue:** اذهب إلى قسم "Issues" في مستودع المشروع على GitHub وقم بإنشاء Issue جديد مع كل التفاصيل التي جمعتها.
