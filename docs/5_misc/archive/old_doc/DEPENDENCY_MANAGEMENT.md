# دليل إدارة الاعتماديات (Dependency Management) - مشروع G-Assistant

**الإصدار:** 1.0
**الحالة:** إلزامي

---

## 1.0 المبدأ الأساسي

كل اعتمادية (Dependency) خارجية هي مسؤولية وديون تقنية محتملة. يتم التعامل مع إضافة أو تحديث الاعتماديات بحذر شديد لضمان أمان واستقرار المشروع. القاعدة الأساسية هي: **لا تُضف اعتمادية إلا عند الضرورة القصوى وبعد اتباع هذا البروتوكول.**

---

## 2.0 مصدر الحقيقة (Source of Truth)

ملف `package.json` هو المصدر الرسمي والوحيد للحقيقة لجميع اعتماديات تطوير المشروع (dev dependencies) مثل أدوات الفحص، الاختبار، والبناء. يجب أن تكون جميع الحزم المستخدمة مسجلة فيه.

---

## 3.0 أنواع الاعتماديات

- **`dependencies`**: تُستخدم للحزم التي سيتم تضمينها في المنتج النهائي (في حالة بناء تطبيق Node.js). في مشروعنا الحالي القائم على Apps Script، هذا القسم غالبًا ما يكون فارغًا.
- **`devDependencies`**: تُستخدم للحزم المطلوبة لعملية التطوير فقط، مثل `eslint`, `prettier`, `jest`. **هذا هو القسم الأكثر استخدامًا في مشروعنا.**

---

## 4.0 بروتوكول إضافة اعتمادية جديدة

يُمنع منعًا باتًا تثبيت أي حزمة بشكل عشوائي. لإضافة اعتمادية تطوير جديدة، يجب اتباع الخطوات التالية بدقة:

1.  **تقديم طلب:** قم بفتح "Issue" جديد في نظام تتبع المشكلات، موضحًا الحاجة إلى الحزمة الجديدة، والمشكلة التي تحلها، والبدائل التي تم النظر فيها.
2.  **المراجعة والتقييم:** تتم مراجعة الطلب من قبل قائد الفريق. يتم تقييم الحزمة بناءً على:
    - **الشعبية والصيانة:** هل الحزمة نشطة ويتم صيانتها بانتظام؟
    - **الأمان:** هل توجد ثغرات أمنية معروفة؟ (استخدم `npm audit` للتحقق).
    - **الحجم والتأثير:** ما هو تأثير الحزمة على بيئة التطوير؟
    - **الترخيص:** هل ترخيص الحزمة متوافق مع سياسات المشروع؟
3.  **الموافقة والتوثيق:** بعد الموافقة، يتم توثيق الحزمة في هذا المستند (القسم 6) قبل تثبيتها.
4.  **التثبيت:** يتم تثبيت الحزمة باستخدام الأمر التالي لتثبيتها كاعتمادية تطوير وتثبيت نسخة محددة:
    ```bash
    npm install --save-dev --save-exact <package-name>
    ```

---

## 5.0 بروتوكول تحديث الاعتماديات

- **المراجعة الدورية:** يجب تشغيل `npm outdated` و `npm audit` بانتظام لمراجعة الحزم القديمة والكشف عن الثغرات الأمنية.
- **التحديثات الأمنية (Security Patches):** يجب تطبيقها فورًا بعد مراجعتها واختبارها باستخدام `npm audit fix`.
- **التحديثات الطفيفة والرئيسية (Minor & Major):** لا يتم التحديث بشكل تلقائي. يجب التعامل معها كإضافة اعتمادية جديدة، مع فتح Issue واختبار التوافق بشكل كامل قبل الدمج.

---

## 6.0 سجل اعتماديات التطوير المعتمدة

يجب توثيق كل حزمة معتمدة هنا مع مبرر استخدامها.

| الحزمة | الإصدار المعتمد | الغرض من الاستخدام |
| --- | --- | --- |
| `eslint` | `^8.x.x` | لفرض معايير الكود وتحليل الجودة. |
| `prettier` | `^3.x.x` | لتوحيد تنسيق الكود بشكل تلقائي. |
| `jest` | `^29.x.x` | لإطار عمل الاختبارات (Unit & Integration). |
| `@google/clasp` | `^2.x.x` | أداة سطر الأوامر لنشر وإدارة مشاريع Google Apps Script. |
| *(أضف المزيد من الحزم هنا عند الموافقة عليها)* | | |

---

## 7.0 الإنفاذ

سيتم فحص ملف `package.json` و `package-lock.json` في كل طلب سحب (Pull Request) لضمان عدم وجود أي حزم غير موثقة أو غير معتمدة. أي تغييرات غير متوافقة مع هذا الدليل سيتم رفضها.
